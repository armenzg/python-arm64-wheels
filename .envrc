#!/usr/bin/bash
set -e

if [ "$(python -V)" != "Python $(cat .python-version)" ]; then
    echo "WARNING: Your version does not match .python-version. You're on your own."
    echo "You could use pyenv to match the version."
fi

if [ ! -f "${HOME}/.local/bin/pdm" ]; then
    curl -sSL https://raw.githubusercontent.com/pdm-project/pdm/main/install-pdm.py | python -
    echo "export PATH=${HOME}/.local/bin:\$PATH" >> ~/.zshrc
    export PATH="${HOME}/.local/bin:$PATH"
    pdm --pep582 >>~/.zshrc
    pdm plugin add pdm-venv
fi

! command -v pdm &>/dev/null && export PATH="${HOME}/.local/bin:$PATH"

echo -e "\nCall the command boilerplate in a directory to create a direnv/pdm environment.\n"
PATH="$(pwd)/bin:$PATH"
export PATH
